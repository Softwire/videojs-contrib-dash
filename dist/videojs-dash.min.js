/*! @name videojs-contrib-dash @version 5.1.2 @license Apache-2.0 */
!function(e,a){"object"==typeof exports&&"undefined"!=typeof module?module.exports=a(require("dashjs"),require("video.js"),require("global/window"),require("global/document")):"function"==typeof define&&define.amd?define(["dashjs","video.js","global/window","global/document"],a):e.videojsDash=a(e.dashjs,e.videojs,e.window,e.document)}(this,function(l,c,s,t){"use strict";function i(o,e){var t=o.dash.mediaPlayer,r=t.getTracksFor("audio"),n=o.audioTracks();function i(e){return"dash-audio-"+e}n.length&&e.clearTracks(["audio"]);var s=t.getCurrentTrackFor("audio");r.forEach(function(e){var a,t;if(Array.isArray(e.labels))for(var r=0;r<e.labels.length;r++)if(e.labels[r].lang&&-1!==o.language().indexOf(e.labels[r].lang.toLowerCase())){a=e.labels[r];break}a?t=a.text:Array.isArray(e.labels)&&1===e.labels.length?t=e.labels[0].text:(t=e.lang,e.roles&&e.roles.length&&(t+=" ("+e.roles.join(", ")+")")),n.addTrack(new c.AudioTrack({enabled:e===s,id:i(e.index),kind:e.kind||"main",label:t,language:e.lang}))});function a(){for(var e=0;e<n.length;e++){var a=n[e];a.enabled&&(a=function(e,a){return e.find(function(e){return i(e.index)===a.id})}(r,a),t.setCurrentTrack(a))}}n.addEventListener("change",a),o.dash.mediaPlayer.on(l.MediaPlayer.events.STREAM_TEARDOWN_COMPLETE,function(){n.removeEventListener("change",a)})}function d(o,e,n){var i=[],a=n.map(function(e){var a;if(Array.isArray(e.labels))for(var t=0;t<e.labels.length;t++)if(e.labels[t].lang&&-1!==o.language().indexOf(e.labels[t].lang.toLowerCase())){a=e.labels[t];break}return{dashTrack:e,trackConfig:{label:a?a.text:Array.isArray(e.labels)&&1===e.labels.length?e.labels[0].text:e.lang||e.label,language:e.lang,srclang:e.lang,kind:e.kind}}}).map(function(e){var a=e.trackConfig,e=e.dashTrack;if(e.isTTML&&!o.getChild("TTMLTextTrackDisplay"))return null;a=o.addRemoteTextTrack(a,!1);return i.push({textTrack:a.track,dashTrack:e}),a}).filter(function(e){return null!==e});function t(){for(var e=o.dash.mediaPlayer,t=o.textTracks(),r=-1,a=0;a<t.length;a+=1)!function(e){var a=t[e];"showing"!==a.mode||(e=(e=function(e,a){for(var t=0;t<e.length;t++)if(a(e[t]))return e[t]}(i,function(e){return e.textTrack===a}))?e.dashTrack:null)&&(r=n.indexOf(e))}(a);r!==e.getCurrentTextTrackIndex()&&e.setTextTrack(r)}return o.textTracks().on("change",t),o.dash.mediaPlayer.on(l.MediaPlayer.events.STREAM_TEARDOWN_COMPLETE,function(){o.textTracks().off("change",t)}),t(),a}function u(a,e,t){s.VTTCue&&!/\[native code\]/.test(s.VTTCue.toString())&&(s.VTTCue=!1);var r,o=[];function n(e){e.index;e=e.tracks;r.off(l.MediaPlayer.events.TEXT_TRACKS_ADDED,n),o.forEach(a.removeRemoteTextTrack.bind(a)),o=[],e.length&&(o=d(a,0,e))}e.featuresNativeTextTracks?c.log.error("You must pass {html: {nativeCaptions: false}} in the videojs constructor to use text tracks in videojs-contrib-dash"):((r=a.dash.mediaPlayer).on(l.MediaPlayer.events.TEXT_TRACKS_ADDED,n),r.on(l.MediaPlayer.events.CAN_PLAY,function(){r.off(l.MediaPlayer.events.TEXT_TRACKS_ADDED,n)}))}function r(e,a){return(r=Object.setPrototypeOf||function(e,a){return e.__proto__=a,e})(e,a)}function h(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}l=l&&l.hasOwnProperty("default")?l.default:l,c=c&&c.hasOwnProperty("default")?c.default:c,s=s&&s.hasOwnProperty("default")?s.default:s,t=t&&t.hasOwnProperty("default")?t.default:t;var e=c.getComponent("Component"),p="#222",y={monospace:"monospace",sansSerif:"sans-serif",serif:"serif",monospaceSansSerif:'"Andale Mono", "Lucida Console", monospace',monospaceSerif:'"Courier New", monospace',proportionalSansSerif:"sans-serif",proportionalSerif:"serif",casual:'"Comic Sans MS", Impact, fantasy',script:'"Monotype Corsiva", cursive',smallcaps:'"Andale Mono", "Lucida Console", monospace, sans-serif'};function f(e,a,t){try{e.style[a]=t}catch(e){return}}function g(e,a){var t;if(4===e.length)t=e[1]+e[1]+e[2]+e[2]+e[3]+e[3];else{if(7!==e.length)throw new Error("Invalid color code provided, "+e+"; must be formatted as e.g. #f0e or #f604e2.");t=e.slice(1)}return"rgba("+parseInt(t.slice(0,2),16)+","+parseInt(t.slice(2,4),16)+","+parseInt(t.slice(4,6),16)+","+a+")"}e=function(i){var e;function a(e,a,t){for(var r=i.call(this,e,c.mergeOptions(a,{playerOptions:{}}),t)||this,o=e.getChild("TextTrackSettings").$$("select"),n=0;n<o.length;n++)r.on(o[n],"change",r.updateStyle.bind(h(r)));return e.dash.mediaPlayer.on(l.MediaPlayer.events.CAPTION_RENDERED,r.updateStyle.bind(h(r))),r}t=i,(e=a).prototype=Object.create(t.prototype),r(e.prototype.constructor=e,t);var t=a.prototype;return t.createEl=function(){var e=i.prototype.createEl.call(this,"div",{className:"vjs-text-track-display-ttml"},{"aria-live":"off","aria-atomic":"true"});return e.style.position="absolute",e.style.left="0",e.style.right="0",e.style.top="0",e.style.bottom="0",e.style.margin="1.5%",e},t.updateStyle=function(e){e=e.captionDiv;if(this.player_.textTrackSettings){var a=this.player_.textTrackSettings.getValues();if(e=e||this.player_.getChild("TTMLTextTrackDisplay").el().firstChild){!function e(a){for(var t in a.style&&(a.style.left=null,a.style.width="100%"),a.children)e(a.children[t])}(e);for(var t=e.getElementsByTagName("span"),r=0;r<t.length;r++){var o,n=t[r];n.parentNode.style.textAlign="center",a.color&&(n.style.color=a.color),a.textOpacity&&f(n,"color",g(a.color||"#fff",a.textOpacity)),a.backgroundColor&&(n.style.backgroundColor=a.backgroundColor),a.backgroundOpacity&&f(n,"backgroundColor",g(a.backgroundColor||"#000",a.backgroundOpacity)),a.windowColor&&(a.windowOpacity?f(n.parentNode,"backgroundColor",g(a.windowColor,a.windowOpacity)):n.parent.style.backgroundColor=a.windowColor),a.edgeStyle&&("dropshadow"===a.edgeStyle?n.style.textShadow="2px 2px 3px #222, 2px 2px 4px #222, 2px 2px 5px "+p:"raised"===a.edgeStyle?n.style.textShadow="1px 1px #222, 2px 2px #222, 3px 3px "+p:"depressed"===a.edgeStyle?n.style.textShadow="1px 1px #ccc, 0 1px #ccc, -1px -1px #222, 0 -1px "+p:"uniform"===a.edgeStyle&&(n.style.textShadow="0 0 4px #222, 0 0 4px #222, 0 0 4px #222, 0 0 4px "+p)),a.fontPercent&&1!==a.fontPercent&&(o=s.parseFloat(n.style.fontSize),n.style.fontSize=o*a.fontPercent+"px",n.style.height="auto",n.style.top="auto",n.style.bottom="2px"),a.fontFamily&&"default"!==a.fontFamily&&("small-caps"===a.fontFamily?n.style.fontVariant="small-caps":n.style.fontFamily=y[a.fontFamily])}}}},a}(e);c.registerComponent("TTMLTextTrackDisplay",e);var o=function(){function n(a,e,r){var t,o=this;r=r||e.options_,this.player=c(r.playerId),this.player.dash=this.player.dash||{},this.tech_=e,this.el_=e.el(),this.elParent_=this.el_.parentNode,this.hasFiniteDuration_=!1,a.src&&(e.isReady_=!1,n.updateSourceData&&(c.log.warn('updateSourceData has been deprecated. Please switch to using hook("updatesource", callback).'),a=n.updateSourceData(a)),n.hooks("updatesource").forEach(function(e){a=e(a)}),t=a.src,this.keySystemOptions_=n.buildDashJSProtData(a.keySystemOptions),this.player.dash.mediaPlayer=l.MediaPlayer().create(),this.mediaPlayer_=this.player.dash.mediaPlayer,n.useVideoJSDebug&&(c.log.warn('useVideoJSDebug has been deprecated. Please switch to using hook("beforeinitialize", callback).'),n.useVideoJSDebug(this.mediaPlayer_)),n.beforeInitialize&&(c.log.warn('beforeInitialize has been deprecated. Please switch to using hook("beforeinitialize", callback).'),n.beforeInitialize(this.player,this.mediaPlayer_)),n.hooks("beforeinitialize").forEach(function(e){e(o.player,o.mediaPlayer_)}),this.mediaPlayer_.initialize(),this.retriggerError_=function(e){if("capability"===e.error&&"mediasource"===e.event)o.player.error({code:4,message:"The media cannot be played because it requires a feature that your browser does not support."});else if("manifestError"!==e.error||"createParser"!==e.event.id&&"codec"!==e.event.id&&"nostreams"!==e.event.id&&"nostreamscomposed"!==e.event.id&&"parse"!==e.event.id&&"multiplexedrep"!==e.event.id)if("mediasource"===e.error)e.event.match("MEDIA_ERR_ABORTED")?o.player.error({code:1,message:e.event}):e.event.match("MEDIA_ERR_NETWORK")?o.player.error({code:2,message:e.event}):e.event.match("MEDIA_ERR_DECODE")?o.player.error({code:3,message:e.event}):e.event.match("MEDIA_ERR_SRC_NOT_SUPPORTED")?o.player.error({code:4,message:e.event}):e.event.match("MEDIA_ERR_ENCRYPTED")?o.player.error({code:5,message:e.event}):(e.event.match("UNKNOWN"),o.player.error({code:4,message:e.event}));else if("capability"===e.error&&"encryptedmedia"===e.event)o.player.error({code:5,message:"The media cannot be played because it requires encryption features that your browser does not support."});else if("key_session"===e.error)o.player.error({code:5,message:e.event});else if("download"===e.error)o.player.error({code:2,message:"The media playback was aborted because too many consecutive download errors occurred."});else{if("mssError"!==e.error)return;o.player.error({code:3,message:e.event})}else o.player.error({code:4,message:e.event.message});setTimeout(function(){o.mediaPlayer_.reset()},10)},this.mediaPlayer_.on(l.MediaPlayer.events.ERROR,this.retriggerError_),this.getDuration_=function(e){var a=e.data.Period_asArray,t=o.hasFiniteDuration_;e.data.mediaPresentationDuration||a[a.length-1].duration?o.hasFiniteDuration_=!0:o.hasFiniteDuration_=!1,o.hasFiniteDuration_!==t&&o.player.trigger("durationchange")},this.mediaPlayer_.on(l.MediaPlayer.events.MANIFEST_LOADED,this.getDuration_),r.dash&&Object.keys(r.dash).forEach(function(e){var a,t;"useTTML"!==e&&(a="set"+e.charAt(0).toUpperCase()+e.slice(1),t=r.dash[e],o.mediaPlayer_.hasOwnProperty(a)&&(c.log.warn("Using dash options in videojs-contrib-dash without the set prefix has been deprecated. Change '"+e+"' to '"+a+"'"),e=a),o.mediaPlayer_.hasOwnProperty(e)?(Array.isArray(t)||(t=[t]),(a=o.mediaPlayer_)[e].apply(a,t)):c.log.warn("Warning: dash configuration option unrecognized: "+e))}),this.mediaPlayer_.attachView(this.el_),r.dash&&r.dash.useTTML&&(this.ttmlContainer_=this.player.addChild("TTMLTextTrackDisplay"),this.mediaPlayer_.attachTTMLRenderingDiv(this.ttmlContainer_.el())),this.mediaPlayer_.setAutoPlay(!1),function(e,a){e.dash.mediaPlayer.on(l.MediaPlayer.events.PLAYBACK_METADATA_LOADED,i.bind(null,e,a))}.call(null,this.player,e),u.call(null,this.player,e,r),this.mediaPlayer_.setProtectionData(this.keySystemOptions_),this.mediaPlayer_.attachSource(t),this.tech_.triggerReady())}n.buildDashJSProtData=function(e){var a={};if(!e||!Array.isArray(e))return null;for(var t=0;t<e.length;t++){var r=e[t],o=c.mergeOptions({},r.options);o.licenseUrl&&(o.serverURL=o.licenseUrl,delete o.licenseUrl),a[r.name]=o}return a};var e=n.prototype;return e.dispose=function(){this.mediaPlayer_&&(this.mediaPlayer_.off(l.MediaPlayer.events.ERROR,this.retriggerError_),this.mediaPlayer_.off(l.MediaPlayer.events.MANIFEST_LOADED,this.getDuration_),this.mediaPlayer_.reset()),this.player.dash&&delete this.player.dash,this.ttmlContainer_&&(this.ttmlContainer_.dispose(),this.player.removeChild("TTMLTextTrackDisplay"))},e.duration=function(){return this.mediaPlayer_.isDynamic()&&!this.hasFiniteDuration_?1/0:this.mediaPlayer_.duration()},n.hooks=function(e,a){return n.hooks_[e]=n.hooks_[e]||[],a&&(n.hooks_[e]=n.hooks_[e].concat(a)),n.hooks_[e]},n.hook=function(e,a){n.hooks(e,a)},n.removeHook=function(e,a){a=n.hooks(e).indexOf(a);return-1!==a&&(n.hooks_[e]=n.hooks_[e].slice(),n.hooks_[e].splice(a,1),!0)},n}();o.hooks_={};return c.DashSourceHandler=function(){return{canHandleSource:function(e){return function(a){a=JSON.parse(JSON.stringify(a)),o.updateSourceData&&(c.log.warn('updateSourceData has been deprecated. Please switch to using hook("updatesource", callback).'),a=o.updateSourceData(a)),o.hooks("updatesource").forEach(function(e){a=e(a)});var e=t.createElement("video");return!(a.keySystemOptions&&!s.navigator.requestMediaKeySystemAccess&&!e.msSetMediaKeys)}(e)?c.DashSourceHandler.canPlayType(e.type)?"probably":/\.mpd/i.test(e.src)?"maybe":"":""},handleSource:function(e,a,t){return new o(e,a,t)},canPlayType:function(e){return c.DashSourceHandler.canPlayType(e)}}},c.DashSourceHandler.canPlayType=function(e){return/^application\/dash\+xml/i.test(e)?"probably":""},s.MediaSource&&c.getTech("Html5").registerSourceHandler(c.DashSourceHandler(),0),c.Html5DashJS=o});
